"use strict";function _classCallCheck(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var appModule=angular.module("material-analytics",["ui.router","material-analytics-ecommerce"]).run(["$window","$rootScope","$location","analyticsConfig",function(a,e,t,r){a.test=1,a.dataLayer=a.dataLayer||[],e.$on("$stateChangeSuccess",function(e,n,o){var c=t.path();a.dataLayer.push({event:"virtualPageView",virtualPage:c,virtualTitle:n.name,tenantID:r.getTenantId()})})}]),_createClass=function(){function a(a,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}}return function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}}(),AnalyticsConfigProvider=function(){function a(){_classCallCheck(this,a),this.tenantId=""}return _createClass(a,[{key:"setTenantId",value:function(a){this.tenantId=a}},{key:"$get",value:function(){var a=this;return{getTenantId:function(){return a.tenantId}}}}]),a}();angular.module("material-analytics").provider("analyticsConfig",AnalyticsConfigProvider),angular.module("material-analytics-ecommerce",["ngLodash"]).run(["$rootScope","$window","maProductImpressions","maCartEvents","maProductDetailsImpressions","maCheckoutTracker","maPurchaseTracker",function(a,e,t,r,n,o,c){e.dataLayer=e.dataLayer||[],e.ga&&e.ga("require","ec"),a.$on("ProductListLoaded",function(a,e,r){t.send(e,r)}),a.$on("ProductDetailLoaded",function(a,e,t){n.send(e,t)}),a.$on("CartEvents.ItemAdded",function(a,e,t,n){r.logAddItemToCart(e,t,n)}),a.$on("CartEvents.ItemRemoved",function(a,e,t){r.logRemoveItemFromCart(e,t)}),a.$on("CheckoutEvents.StepCompleted",function(a,e,t,r){o.logCheckoutStep(e,t,r)}),a.$on("CheckoutEvents.OrderPlaced",function(a,e){c.logPurchase(e)})}]),angular.module("material-analytics-ecommerce").factory("maCartEvents",["$window","maProductPayload",function(a,e){return{logAddItemToCart:function(t,r,n){var o=void 0,c=void 0,i=e.create(t,n,o,c,r);a.dataLayer.push({event:"addToCart",ecommerce:{add:{products:[i]}}})},logRemoveItemFromCart:function(t,r){var n=void 0,o=void 0,c=void 0,i=e.create(t,c,n,o,Math.abs(r));a.dataLayer.push({event:"removeFromCart",ecommerce:{remove:{products:[i]}}})}}}]),angular.module("material-analytics-ecommerce").factory("maCheckoutTracker",["$window","maCartPayload",function(a,e){return{logCheckoutStep:function(t,r,n){a.dataLayer.push({event:"checkout",ecommerce:{checkout:{actionField:{step:t,option:r},products:e.extractProducts(n)}}})}}}]),angular.module("material-analytics-ecommerce").factory("maCartPayload",function(){return{extractProducts:function(a){var e=a.items,t=e.map(function(a){var e=a.product,t=a.quantity;return{name:e.name,id:e.sku,price:e.price,quantity:t}});return t}}}),angular.module("material-analytics-ecommerce").factory("maProductPayload",function(){return{create:function(a,e,t,r,n){var o=a.sku,c=a.name,i=a.price,u={name:c,id:o,price:i,category:e};return angular.isDefined(t)&&(u.list=t),isFinite(r)&&(u.position=r),isFinite(n)&&(u.quantity=n),u}}}),angular.module("material-analytics-ecommerce").directive("maProductClickTracker",["$window","maProductPayload",function(a,e){return{restrict:"A",scope:{product:"=maProductClickTracker",productCategory:"@",productPosition:"@"},link:function(t,r){var n=function(){var r=void 0,n=void 0;angular.isDefined(t.productPosition)&&angular.isNumber(parseInt(t.productPosition))&&(n=parseInt(t.productPosition));var o=e.create(t.product,t.productCategory,r,n);a.dataLayer.push({ecommerce:{click:{products:[o]}}})};r.on("click",n),t.$on("$destroy",function(){r.off("click",n)})}}}]),angular.module("material-analytics-ecommerce").factory("maProductDetailsImpressions",["$window","lodash","maProductPayload",function(a,e,t){return{send:function(e){var r=arguments.length<=1||void 0===arguments[1]?"":arguments[1],n=t.create(e,r);a.dataLayer.push({ecommerce:{detail:{products:[n]}}})}}}]),angular.module("material-analytics-ecommerce").factory("maProductImpressions",["$window","lodash","maProductPayload",function(a,e,t){return{send:function(r){var n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],o=e.map(r,function(a,e){var r=(a.name,a.id,a.price,"");return""!==n&&(r="Category"),t.create(a,n,r,e+1)});a.dataLayer.push({ecommerce:{impressions:o}})}}}]),angular.module("material-analytics-ecommerce").factory("maPurchaseTracker",["$window","maCartPayload",function(a,e){return{logPurchase:function(t){a.dataLayer.push({ecommerce:{purchase:{actionField:{id:t.orderNumber,affiliation:"Online Store",revenue:t.grandTotal,tax:t.taxAmount,shipping:t.cart.shippingMethod.shippingCost},products:e.extractProducts(t.cart)}}})}}}]);